var data = {
  "Dates": [
    {
      "Datum": "14.04.2025",
      "Tag": "Montag",
      "Mahlzeiten": [
        {
          "Name": "Frühstück",
          "Gericht": "Haferflocken mit Banane und Honig",
          "Zutaten": [
            {
              "Amount": 50,
              "Metric": "g",
              "Name": "Haferflocken"
            },
            {
              "Amount": 1,
              "Metric": "Stück",
              "Name": "Banane"
            },
            {
              "Amount": 1,
              "Metric": "EL",
              "Name": "Honig"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Haferflocken in Schüssel geben."
            ],
            [
              "2",
              "Banane in Scheiben schneiden und hinzufügen."
            ],
            [
              "3",
              "Mit Honig süßen."
            ]
          ],
          "Nährwerte": {
            "Kcal": 350,
            "Protein": 8,
            "Kohlenhydrate": 60,
            "Fett": 7
          }
        },
        {
          "Name": "Mittagessen",
          "Gericht": "Hähnchenbrust mit Reis und Brokkoli",
          "Zutaten": [
            {
              "Amount": 150,
              "Metric": "g",
              "Name": "Hähnchenbrust"
            },
            {
              "Amount": 100,
              "Metric": "g",
              "Name": "Reis"
            },
            {
              "Amount": 100,
              "Metric": "g",
              "Name": "Brokkoli"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Hähnchenbrust würzen und braten."
            ],
            [
              "2",
              "Reis kochen."
            ],
            [
              "3",
              "Brokkoli dämpfen und mit Reis und Fleisch servieren."
            ]
          ],
          "Nährwerte": {
            "Kcal": 500,
            "Protein": 35,
            "Kohlenhydrate": 40,
            "Fett": 20
          }
        },
        {
          "Name": "Abendessen",
          "Gericht": "Gemüsesuppe",
          "Zutaten": [
            {
              "Amount": 1,
              "Metric": "Stück",
              "Name": "Karotte"
            },
            {
              "Amount": 1,
              "Metric": "Stück",
              "Name": "Kartoffel"
            },
            {
              "Amount": 1,
              "Metric": "Stück",
              "Name": "Zwiebel"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Gemüse schälen und klein schneiden."
            ],
            [
              "2",
              "In Brühe kochen bis weich."
            ],
            [
              "3",
              "Mit Kräutern abschmecken."
            ]
          ],
          "Nährwerte": {
            "Kcal": 250,
            "Protein": 5,
            "Kohlenhydrate": 30,
            "Fett": 8
          }
        }
      ]
    },
    {
      "Datum": "15.04.2025",
      "Tag": "Dienstag",
      "Mahlzeiten": [
        {
          "Name": "Frühstück",
          "Gericht": "Joghurt mit Müsli und Beeren",
          "Zutaten": [
            {
              "Amount": 150,
              "Metric": "g",
              "Name": "Naturjoghurt"
            },
            {
              "Amount": 30,
              "Metric": "g",
              "Name": "Müsli"
            },
            {
              "Amount": 50,
              "Metric": "g",
              "Name": "Beerenmix"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Joghurt in eine Schüssel geben."
            ],
            [
              "2",
              "Müsli und Beeren darauf verteilen."
            ],
            [
              "3",
              "Optional mit Honig süßen."
            ]
          ],
          "Nährwerte": {
            "Kcal": 300,
            "Protein": 10,
            "Kohlenhydrate": 35,
            "Fett": 10
          }
        },
        {
          "Name": "Mittagessen",
          "Gericht": "Linsensalat mit Feta",
          "Zutaten": [
            {
              "Amount": 100,
              "Metric": "g",
              "Name": "Linsen"
            },
            {
              "Amount": 50,
              "Metric": "g",
              "Name": "Feta"
            },
            {
              "Amount": 50,
              "Metric": "g",
              "Name": "Paprika"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Linsen kochen."
            ],
            [
              "2",
              "Paprika würfeln, Feta zerbröseln."
            ],
            [
              "3",
              "Alles mischen und würzen."
            ]
          ],
          "Nährwerte": {
            "Kcal": 450,
            "Protein": 20,
            "Kohlenhydrate": 40,
            "Fett": 18
          }
        },
        {
          "Name": "Abendessen",
          "Gericht": "Rührei mit Spinat",
          "Zutaten": [
            {
              "Amount": 2,
              "Metric": "Stück",
              "Name": "Eier"
            },
            {
              "Amount": 50,
              "Metric": "g",
              "Name": "Spinat"
            },
            {
              "Amount": 1,
              "Metric": "EL",
              "Name": "Milch"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Eier mit Milch verquirlen."
            ],
            [
              "2",
              "Spinat kurz anbraten."
            ],
            [
              "3",
              "Eiermasse dazugeben und stocken lassen."
            ]
          ],
          "Nährwerte": {
            "Kcal": 280,
            "Protein": 15,
            "Kohlenhydrate": 3,
            "Fett": 22
          }
        }
      ]
    },
    {
      "Datum": "16.04.2025",
      "Tag": "Mittwoch",
      "Mahlzeiten": [
        {
          "Name": "Frühstück",
          "Gericht": "Spiegelei mit Vollkorntoast",
          "Zutaten": [
            {
              "Amount": 2,
              "Metric": "Stück",
              "Name": "Eier"
            },
            {
              "Amount": 2,
              "Metric": "Scheiben",
              "Name": "Vollkorntoast"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Eier in einer Pfanne zu Spiegeleiern braten."
            ],
            [
              "2",
              "Toast rösten und mit Spiegelei servieren."
            ]
          ],
          "Nährwerte": {
            "Kcal": 320,
            "Protein": 14,
            "Kohlenhydrate": 20,
            "Fett": 22
          }
        },
        {
          "Name": "Mittagessen",
          "Gericht": "Gemüsepfanne mit Tofu",
          "Zutaten": [
            {
              "Amount": 150,
              "Metric": "g",
              "Name": "Tofu"
            },
            {
              "Amount": 100,
              "Metric": "g",
              "Name": "Gemüsemix"
            },
            {
              "Amount": 1,
              "Metric": "EL",
              "Name": "Sojasauce"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Tofu würfeln und anbraten."
            ],
            [
              "2",
              "Gemüse hinzufügen und mitbraten."
            ],
            [
              "3",
              "Mit Sojasauce würzen."
            ]
          ],
          "Nährwerte": {
            "Kcal": 420,
            "Protein": 22,
            "Kohlenhydrate": 18,
            "Fett": 25
          }
        },
        {
          "Name": "Abendessen",
          "Gericht": "Quark mit Obst",
          "Zutaten": [
            {
              "Amount": 250,
              "Metric": "g",
              "Name": "Magerquark"
            },
            {
              "Amount": 100,
              "Metric": "g",
              "Name": "Obst nach Wahl"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Quark in eine Schüssel geben."
            ],
            [
              "2",
              "Obst klein schneiden und untermischen."
            ]
          ],
          "Nährwerte": {
            "Kcal": 280,
            "Protein": 20,
            "Kohlenhydrate": 15,
            "Fett": 10
          }
        }
      ]
    },
    {
      "Datum": "17.04.2025",
      "Tag": "Donnerstag",
      "Mahlzeiten": [
        {
          "Name": "Frühstück",
          "Gericht": "Smoothie mit Haferflocken",
          "Zutaten": [
            {
              "Amount": 1,
              "Metric": "Stück",
              "Name": "Banane"
            },
            {
              "Amount": 200,
              "Metric": "ml",
              "Name": "Milch"
            },
            {
              "Amount": 30,
              "Metric": "g",
              "Name": "Haferflocken"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Alle Zutaten in Mixer geben."
            ],
            [
              "2",
              "Zu einem Smoothie pürieren."
            ]
          ],
          "Nährwerte": {
            "Kcal": 330,
            "Protein": 10,
            "Kohlenhydrate": 45,
            "Fett": 8
          }
        },
        {
          "Name": "Mittagessen",
          "Gericht": "Kartoffelgratin mit Salat",
          "Zutaten": [
            {
              "Amount": 200,
              "Metric": "g",
              "Name": "Kartoffeln"
            },
            {
              "Amount": 50,
              "Metric": "g",
              "Name": "Käse"
            },
            {
              "Amount": 100,
              "Metric": "g",
              "Name": "Salat"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Kartoffeln in Scheiben schneiden."
            ],
            [
              "2",
              "Mit Käse überbacken."
            ],
            [
              "3",
              "Salat waschen und servieren."
            ]
          ],
          "Nährwerte": {
            "Kcal": 500,
            "Protein": 15,
            "Kohlenhydrate": 40,
            "Fett": 30
          }
        },
        {
          "Name": "Abendessen",
          "Gericht": "Gemüsebrot mit Frischkäse",
          "Zutaten": [
            {
              "Amount": 2,
              "Metric": "Scheiben",
              "Name": "Vollkornbrot"
            },
            {
              "Amount": 50,
              "Metric": "g",
              "Name": "Frischkäse"
            },
            {
              "Amount": 50,
              "Metric": "g",
              "Name": "Gemüsestreifen"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Brot mit Frischkäse bestreichen."
            ],
            [
              "2",
              "Gemüse darauflegen."
            ]
          ],
          "Nährwerte": {
            "Kcal": 300,
            "Protein": 8,
            "Kohlenhydrate": 25,
            "Fett": 15
          }
        }
      ]
    },
    {
      "Datum": "18.04.2025",
      "Tag": "Freitag",
      "Mahlzeiten": [
        {
          "Name": "Frühstück",
          "Gericht": "Bircher Müsli",
          "Zutaten": [
            {
              "Amount": 40,
              "Metric": "g",
              "Name": "Haferflocken"
            },
            {
              "Amount": 1,
              "Metric": "Stück",
              "Name": "Apfel"
            },
            {
              "Amount": 100,
              "Metric": "g",
              "Name": "Joghurt"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Apfel reiben."
            ],
            [
              "2",
              "Mit Joghurt und Haferflocken vermengen."
            ]
          ],
          "Nährwerte": {
            "Kcal": 350,
            "Protein": 10,
            "Kohlenhydrate": 40,
            "Fett": 12
          }
        },
        {
          "Name": "Mittagessen",
          "Gericht": "Fischfilet mit Kartoffeln",
          "Zutaten": [
            {
              "Amount": 150,
              "Metric": "g",
              "Name": "Fischfilet"
            },
            {
              "Amount": 150,
              "Metric": "g",
              "Name": "Kartoffeln"
            },
            {
              "Amount": 1,
              "Metric": "EL",
              "Name": "Öl"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Fisch braten."
            ],
            [
              "2",
              "Kartoffeln kochen und mit Fisch servieren."
            ]
          ],
          "Nährwerte": {
            "Kcal": 480,
            "Protein": 30,
            "Kohlenhydrate": 25,
            "Fett": 25
          }
        },
        {
          "Name": "Abendessen",
          "Gericht": "Tomaten-Mozzarella-Salat",
          "Zutaten": [
            {
              "Amount": 100,
              "Metric": "g",
              "Name": "Tomaten"
            },
            {
              "Amount": 100,
              "Metric": "g",
              "Name": "Mozzarella"
            },
            {
              "Amount": 1,
              "Metric": "EL",
              "Name": "Olivenöl"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Tomaten und Mozzarella in Scheiben schneiden."
            ],
            [
              "2",
              "Mit Öl beträufeln."
            ]
          ],
          "Nährwerte": {
            "Kcal": 350,
            "Protein": 15,
            "Kohlenhydrate": 5,
            "Fett": 30
          }
        }
      ]
    },
    {
      "Datum": "19.04.2025",
      "Tag": "Samstag",
      "Mahlzeiten": [
        {
          "Name": "Frühstück",
          "Gericht": "Porridge mit Apfel",
          "Zutaten": [
            {
              "Amount": 50,
              "Metric": "g",
              "Name": "Haferflocken"
            },
            {
              "Amount": 200,
              "Metric": "ml",
              "Name": "Milch"
            },
            {
              "Amount": 1,
              "Metric": "Stück",
              "Name": "Apfel"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Haferflocken in Milch kochen."
            ],
            [
              "2",
              "Apfel reiben und unterrühren."
            ]
          ],
          "Nährwerte": {
            "Kcal": 320,
            "Protein": 9,
            "Kohlenhydrate": 40,
            "Fett": 10
          }
        },
        {
          "Name": "Mittagessen",
          "Gericht": "Pasta mit Pesto",
          "Zutaten": [
            {
              "Amount": 100,
              "Metric": "g",
              "Name": "Pasta"
            },
            {
              "Amount": 2,
              "Metric": "EL",
              "Name": "Pesto"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Pasta kochen."
            ],
            [
              "2",
              "Mit Pesto vermengen."
            ]
          ],
          "Nährwerte": {
            "Kcal": 450,
            "Protein": 12,
            "Kohlenhydrate": 50,
            "Fett": 20
          }
        },
        {
          "Name": "Abendessen",
          "Gericht": "Gemüseomelett",
          "Zutaten": [
            {
              "Amount": 2,
              "Metric": "Stück",
              "Name": "Eier"
            },
            {
              "Amount": 50,
              "Metric": "g",
              "Name": "Paprika"
            },
            {
              "Amount": 50,
              "Metric": "g",
              "Name": "Zucchini"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Gemüse anbraten."
            ],
            [
              "2",
              "Eier verquirlen und über das Gemüse geben."
            ],
            [
              "3",
              "Stocken lassen."
            ]
          ],
          "Nährwerte": {
            "Kcal": 300,
            "Protein": 14,
            "Kohlenhydrate": 6,
            "Fett": 22
          }
        }
      ]
    },
    {
      "Datum": "20.04.2025",
      "Tag": "Sonntag",
      "Mahlzeiten": [
        {
          "Name": "Frühstück",
          "Gericht": "Croissant mit Marmelade",
          "Zutaten": [
            {
              "Amount": 1,
              "Metric": "Stück",
              "Name": "Croissant"
            },
            {
              "Amount": 1,
              "Metric": "EL",
              "Name": "Marmelade"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Croissant aufschneiden und mit Marmelade bestreichen."
            ]
          ],
          "Nährwerte": {
            "Kcal": 400,
            "Protein": 6,
            "Kohlenhydrate": 35,
            "Fett": 25
          }
        },
        {
          "Name": "Mittagessen",
          "Gericht": "Rindersteak mit Gemüse",
          "Zutaten": [
            {
              "Amount": 200,
              "Metric": "g",
              "Name": "Rindersteak"
            },
            {
              "Amount": 100,
              "Metric": "g",
              "Name": "Gemüse"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Steak braten."
            ],
            [
              "2",
              "Gemüse dünsten und dazu servieren."
            ]
          ],
          "Nährwerte": {
            "Kcal": 550,
            "Protein": 40,
            "Kohlenhydrate": 10,
            "Fett": 35
          }
        },
        {
          "Name": "Abendessen",
          "Gericht": "Kartoffelsuppe",
          "Zutaten": [
            {
              "Amount": 200,
              "Metric": "g",
              "Name": "Kartoffeln"
            },
            {
              "Amount": 1,
              "Metric": "Stück",
              "Name": "Karotte"
            },
            {
              "Amount": 1,
              "Metric": "Stück",
              "Name": "Zwiebel"
            }
          ],
          "Zubereitung": [
            [
              "1",
              "Gemüse schälen und würfeln."
            ],
            [
              "2",
              "Mit Brühe kochen und pürieren."
            ]
          ],
          "Nährwerte": {
            "Kcal": 300,
            "Protein": 6,
            "Kohlenhydrate": 35,
            "Fett": 12
          }
        }
      ]
    }
  ]
}

let currentDayOfWeek = 1;
let currentTimeOfDay = 2;
displayMeal(data.Dates[currentDayOfWeek], currentTimeOfDay);

//Function for the JSON inputfield and changing data
function openForm() {
  let jsonString = prompt("Enter new JSON data:");

  let jsonObject = JSON.parse(jsonString);
  data = jsonObject;
  displayMeal(data.Dates[0]);
}

function displayMeal(meal, timeOfDay) {
  //Header
  document.getElementById("weekday").innerHTML = meal.Tag;
  document.getElementById("meal-dateofDay").innerHTML = meal.Datum;

  //Time of day
  document.getElementById("meal-timeOfDay").innerHTML = meal.Mahlzeiten[timeOfDay].Name;

  //Recipe
  document.getElementById("meal-recipe-name").innerHTML = meal.Mahlzeiten[timeOfDay].Gericht;

  //Zutaten
  updateIngredients(meal.Mahlzeiten[timeOfDay].Zutaten);

  //Preperations (also loop)
  let preperation = meal.Mahlzeiten[timeOfDay].Zubereitung;
  let preperationsHtml = document.getElementById("meal-preperations");

  preperationsHtml.innerHTML = "Zubereitung: </br>";
  preperationsHtml.innerHTML += "<ol>";

  for (let i = 0; i < preperation.length; i++) {
    let currentStep = preperation[i];
    preperationsHtml.innerHTML += "<li type='1'>" + currentStep[1] + "</li></br>";
  }
  preperationsHtml.innerHTML += "</ol>";
}

function calculatePortions() {
  let portion = document.getElementById("portionInput").value;
  let zutaten = data.Dates[currentDayOfWeek].Mahlzeiten[currentTimeOfDay].Zutaten;

  // Deep copy the zutaten array to prevent mutation
  let zutatenCopy = zutaten.map(z => ({
    ...z,
    Amount: z.Amount * portion
  }));

  updateIngredients(zutatenCopy);
}

function updateIngredients(ingredients) {
  //Ingredients aka zutaten
  let ingredientsHtml = document.getElementById("meal-ingredients");
  ingredientsHtml.innerHTML = "Zutaten: </br>";
  ingredientsHtml.innerHTML += "<ul>";

  //Loop over all the ingredients, and display them in a list-style fashion onto the webpage
  for (let i = 0; i < ingredients.length; i++) {
    let currentIngredient = ingredients[i];

    ingredientsHtml.innerHTML += "<li><span class='inline-block'>" + currentIngredient.Amount + " " + currentIngredient.Metric + "</span>" + "<span class='inline-block' style='width:100px;'>" + currentIngredient.Name + "</span>" + "</li>";
  }

  ingredientsHtml.innerHTML += "</ul> </br>"
}

function resetPortion() {
  portion = 1;
  document.getElementById("portionInput").value = 1;
}


//Sidebar


let styleSidenav = document.getElementById("sidenav").style;
let styleSection = document.getElementById("section").style;
let styleHeader = document.getElementById("date-container").style;
let styleImage = document.getElementById("img-magiic-chef").style;

function openfunction() {

  if (window.matchMedia("(max-width:400px)").matches) {        //Phone Resolution

    styleSidenav.width = "125px";
    styleSection.marginLeft = "130px";

    styleHeader.fontSize = "80%";
    styleHeader.marginLeft = "130px";
    styleHeader.transitionDuration = "1s"
    styleHeader.transitionDelay = "0.2s";

    styleImage.right = "25px";
    styleImage.maxWidth = "100px";
    styleImage.transitionDuration = "1s";
  }
  else {
    styleSidenav.width = "200px";
    styleSection.marginLeft = "250px";
  }
  styleSidenav.transition = "width 0.8s";
}

function closefunction() {

  if (window.matchMedia("(max-width:400px)").matches) {        //Phone Resolution

    styleSidenav.width = "0px";
    styleSection.marginLeft = "30px";
    styleHeader.fontSize = "100%";
    styleHeader.marginLeft = "70px";
    styleImage.maxWidth = "120px";
    styleImage.right = "-5px";
  }
  else {
    styleSidenav.width = "0px";
    styleSection.marginLeft = "130px";
  }
}

function selectDay(day) {
  try {
    currentDayOfWeek = day;
    displayMeal(data.Dates[day], currentTimeOfDay);
  }
  catch (ex) {

  }

  for (let i = 0; i < 7; i++) {
    if (i == day) {
      let element = document.getElementById("container-" + day);
      element.style.display = "block";
    }
    else {
      document.getElementById("container-" + i).style.display = "none";
    }
  }
  resetPortion();
}

function selectMeal(meal) {
  currentTimeOfDay = meal;
  resetPortion();
  displayMeal(data.Dates[currentDayOfWeek], currentTimeOfDay)
}